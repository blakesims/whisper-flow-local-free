# Task: Carousel Template Redesign

## Task ID
T024

## Meta
- **Status:** EXECUTING_PHASE_1
- **Last Updated:** 2026-02-08

## Overview

T022 Phase 2 built two carousel templates (dark-purple and light) as a functional MVP. Blake tested the output and found it needs significant visual improvement: boring layout, pixelated mermaid diagrams, no profile photo, block text without structure. This task redesigns the carousel templates to be professional, informative, and trust-building — each slide should be useful on its own.

The approach: start with a mockup ideation phase (5 different styles), Blake picks winner(s), then implement the chosen design.

## Objectives
- Design professional carousel templates that Blake would confidently post on LinkedIn
- Title page: book-style title/subtitle, header with name + community name, profile photo
- Content slides: timeline/progress indicator (filled circles showing position), title + structured content per slide
- Each slide informative on its own (title → information, not just decoration)
- Header bar on every slide: Blake's name (left) + "Claude Code Architects" (right) — configurable
- Profile photo: circular cutout from provided transparent PNG
- Content supports: bullet points, numbered lists, line breaks — not block text
- Mermaid diagrams rendered as SVG (not pixelated PNG)
- Timeline/progress indicator: both cosmetic (position) and semantic (step in process)

## Dependencies
- `T022` — Content Engine (provides carousel template system, render pipeline, Jinja2 + Playwright infrastructure)
- `T023` — Content Curation Workflow (provides staging area where template selection happens). Note: T024 Phases 0-2 can proceed in parallel with T023 since template work is independent.

## Rules Required
- None

## Resources & References
- `kb/carousel_templates/dark-purple.html` — current primary template (to be replaced)
- `kb/carousel_templates/light.html` — current secondary template (to be replaced)
- `kb/carousel_templates/config.json` — template configuration (colors, fonts, dimensions, brand)
- `kb/render.py` — rendering pipeline (HTML → PDF via Playwright, mermaid via mmdc)
- Blake's profile photo: to be provided as `profile.png` (transparent background PNG, placed in config-accessible location)
- LinkedIn carousel best practices: 1080x1350px portrait, 6-10 slides, 10-30 words per slide

## Open Questions

| # | Question | Options | Impact |
|---|----------|---------|--------|
| Q1 | Profile photo placement on title page? | Explore in Phase 0 mockups — each mockup tries a different placement | Visual decision, not technical |
| Q3 | Color palette expansion? | Explore in Phase 0 mockups — 5 different palettes shown | Visual decision, not technical |

Note: Q2 (timeline style) and Q4 (font choice) folded into Phase 0 mockup scope — each mockup explores different options, Blake picks visually.

## Decision Matrix

### Resolved

| # | Decision | Rationale |
|---|----------|-----------|
| D1 | Mermaid renders as SVG, not PNG | Eliminates pixelation. mmdc supports `-o output.svg`. Playwright can embed SVG directly in HTML. |
| D2 | Profile photo stored as `profile.png` in config-accessible location | Blake provides transparent PNG. Path configurable via carousel config. |
| D3 | "Claude Code Architects" is configurable, not hardcoded | Stored in carousel_templates/config.json alongside other brand settings. |
| D4 | Slide content types: bullets, numbered lists, free-form text, mermaid | Types defined in slide JSON structure. Template renders each type differently. |
| D5 | Timeline indicator is cosmetic + semantic | Shows slide position AND conveys "step N of M" process meaning. |
| D6 | Phase 0 produces 5 mockup styles, Blake picks winner(s) | Design by mockup iteration, not guessing. |
| D7 | Structured content as markdown in string | LLM outputs markdown (`- item` for bullets, `1. item` for numbered). Template parses and renders. No carousel_slides.json schema change needed — `content` stays a string, template handles markdown→HTML conversion. |
| D8 | SVG embedding uses `Markup()` wrapping to bypass Jinja2 autoescape | Mermaid SVG is generated by mmdc (trusted source), not user input. `Markup(svg_content)` in Python before passing to template. |
| D9 | Profile photo: Blake provides `profile.png`, stored at `kb/carousel_templates/profile.png` | Config.json gets `profile_photo_path` field. Phase 0 uses a placeholder circle. |
| D10 | Profile photo work consolidated in Phase 1 (title page) | Removed from Phase 4 to avoid contradiction. Phase 4 is polish only. |

---

## Phases Breakdown

### Phase 0: Mockup Ideation
**Status**: Not Started

**Objectives:**
- Generate 5 distinct carousel template mockups as standalone HTML files
- Each mockup shows a complete mini-carousel: title page + 3 content slides + 1 mermaid slide + CTA slide
- Use dummy text that resembles real LinkedIn post content (AI/automation/coding topic)
- Each mockup explores a different visual direction:
  1. **Clean Professional** — white/light, minimal, Inter font, thin accent lines
  2. **Dark Bold** — dark background, bold typography, high contrast, gradient accents
  3. **Brand Purple** — evolved dark-purple with timeline indicator, structured content
  4. **Modern Editorial** — magazine-style layout, large numbers, pull-quote styling
  5. **Tech Minimal** — monospace accents, code-editor feel, syntax-highlight colors
- Each mockup includes: header bar (name + community), profile photo placeholder (circle), timeline/progress indicator, title slide with book-style layout, content slides with bullets/lists, mermaid slide (inline SVG example)
- Mockups are self-contained HTML files viewable in a browser — no build step
- Blake reviews and picks winner(s), may request hybrid of elements from multiple mockups

**Estimated Time**: 3-4 hours

**Resources Needed:**
- HTML/CSS skills
- Current config.json for dimensions (1080x1350px)
- Dummy content for slides
- Profile photo placeholder (gray circle with silhouette)

**Dependencies:** None

**Files:**
- `kb/carousel_templates/mockups/` — NEW: directory for mockup HTML files
- `kb/carousel_templates/mockups/1-clean-professional.html` — NEW
- `kb/carousel_templates/mockups/2-dark-bold.html` — NEW
- `kb/carousel_templates/mockups/3-brand-purple.html` — NEW
- `kb/carousel_templates/mockups/4-modern-editorial.html` — NEW
- `kb/carousel_templates/mockups/5-tech-minimal.html` — NEW
- `kb/carousel_templates/mockups/README.md` — NEW: instructions for viewing mockups

**Acceptance Criteria:**
- [ ] 5 distinct HTML mockup files generated
- [ ] Each shows: title page, 3+ content slides, mermaid slide, CTA slide
- [ ] Header bar visible on each slide with name + community
- [ ] Profile photo placeholder on title slide
- [ ] Timeline/progress indicator visible on content slides
- [ ] Content uses bullets/lists (not block text)
- [ ] Each file opens in browser at correct dimensions (1080x1350)
- [ ] Blake reviews and selects winner(s)

---

### Phase 1: Title Page Template + Config Schema
**Status**: Not Started

**Objectives:**
- **Convert Phase 0 winner from static HTML mockup to parameterized Jinja2 template.** Key steps: extract hardcoded text into `{{ variables }}`, move colors/fonts into config.json, replace static content with `{% for slide in slides %}` loops, add conditional blocks for optional elements.
- Implement the chosen title page design from Phase 0 winner
- Book-style layout: large title text, smaller subtitle/subheading
- Header bar: Blake's name (left), community name (right) — from config.json
- Profile photo: circular cutout, loaded from configurable path. Photo converted to base64 data URI in Python before passing to template (same pattern as mermaid in Phase 3, avoids Playwright local file blocking).
- All text/brand elements configurable via config.json
- Responsive text sizing: title scales based on character count (short titles = larger font)

**Config.json schema additions:**
```json
{
  "brand": {
    "author_name": "Blake Sims",
    "community_name": "Claude Code Architects",
    "profile_photo_path": "profile.png"
  },
  "header": {
    "show_on_all_slides": true,
    "author_position": "left",
    "community_position": "right"
  }
}
```

**Estimated Time**: 3-4 hours

**Resources Needed:**
- Phase 0 winner mockup as reference
- `profile.png` from Blake (or placeholder for initial implementation)
- config.json schema design

**Dependencies:** Phase 0 (Blake's choice)

**Files:**
- `kb/carousel_templates/config.json` — MODIFY: add brand.author_name, brand.community_name, brand.profile_photo_path, header settings
- `kb/carousel_templates/<winner>.html` — NEW: Jinja2 template converted from Phase 0 mockup
- `kb/render.py` — MODIFY: load profile photo as base64, pass to template context
- `kb/tests/test_carousel_templates.py` — MODIFY: tests for new template elements, config schema

**Acceptance Criteria:**
- [ ] Title page renders with book-style title + subtitle
- [ ] Header bar shows name + community name from config
- [ ] Profile photo renders as circular cutout (base64 data URI, not local file path)
- [ ] Text sizes scale based on content length
- [ ] All elements configurable via config.json
- [ ] Jinja2 template is fully parameterized (no hardcoded text from mockup)

---

### Phase 2: Content Slide Template
**Status**: Not Started

**Objectives:**
- Implement content slide design from Phase 0 winner
- Timeline/progress indicator at top of each slide: shows current position in carousel
- Indicator is both cosmetic (position) and semantic (step in process)
- Each slide has: header bar, timeline indicator, slide title (bold), content area
- Content area supports: bullet points (•), numbered lists (1. 2. 3.), free-form text with line breaks — content is markdown in a string, template parses `- ` as bullets, `1. ` as numbered list, and `\n` as line breaks. Add a Jinja2 custom filter or macro for markdown→HTML conversion.
- Slide types: hook, content, mermaid, cta — each rendered appropriately
- CTA slide: clear call-to-action styling
- Consistent header on every slide
- Proper spacing and typography — readable, not cramped

**Estimated Time**: 3-4 hours

**Resources Needed:**
- Phase 0 winner mockup as reference
- Jinja2 template system
- Current slide JSON schema

**Dependencies:** Phase 1

**Files:**
- `kb/carousel_templates/<winner>.html` — MODIFY: implement content slide sections
- `kb/carousel_templates/config.json` — MODIFY: timeline indicator settings if needed
- `kb/tests/test_carousel_templates.py` — MODIFY: tests for content slides, timeline, all content types

**Acceptance Criteria:**
- [ ] Content slides render with timeline indicator showing position
- [ ] Timeline fills in as slides progress
- [ ] Bullet points render as actual bullets (not raw text)
- [ ] Numbered lists render with proper numbering
- [ ] Free-form text has line breaks (not single block)
- [ ] Header bar consistent across all slides
- [ ] Text is readable at 1080x1350 dimensions

---

### Phase 3: Mermaid SVG + Rendering Quality
**Status**: Not Started

**Objectives:**
- Switch mermaid rendering from PNG to SVG (`mmdc -o output.svg`)
- Embed SVG inline in HTML using `Markup()` wrapping to bypass Jinja2 autoescape (mermaid output is trusted, not user input)
- Update `render_pipeline()` in `render.py`: change hardcoded `data:image/png;base64,{img_data}` (line 463) to handle SVG. Since we're embedding inline SVG (not base64), the entire mermaid→data-URI pipeline changes to mermaid→read SVG file→`Markup(svg_content)`→pass to template.
- Update `render_mermaid()`: output `.svg` instead of `.png`, return SVG string content (not file path)
- Mermaid diagram styled to match chosen template (colors, fonts) via mmdc `--theme` and `--cssFile` flags
- mmdc theme configuration to match carousel brand colors
- Ensure mermaid text is readable within carousel slide dimensions
- Fallback: if SVG rendering fails, gracefully degrade (log warning, skip slide)

**Estimated Time**: 2-3 hours

**Resources Needed:**
- `mmdc` CLI (already installed)
- `kb/render.py` — mermaid rendering functions
- Jinja2 `Markup()` for trusted SVG injection

**Dependencies:** Phase 2

**Files:**
- `kb/render.py` — MODIFY: `render_mermaid()` outputs SVG instead of PNG, returns SVG string. `render_pipeline()` passes SVG as `Markup()` to template (not base64 data URI). Fix hardcoded `data:image/png` MIME type.
- `kb/carousel_templates/<winner>.html` — MODIFY: mermaid slide renders `{{ slide.mermaid_svg }}` (already marked safe via Markup())
- `kb/tests/test_render.py` — MODIFY: update mermaid tests for SVG output, verify Markup() wrapping

**Acceptance Criteria:**
- [ ] mmdc generates SVG output (not PNG)
- [ ] SVG embedded inline in HTML via Markup() (not escaped by autoescape)
- [ ] Mermaid diagrams render crisp at 1080x1350 (no pixelation)
- [ ] Mermaid colors match carousel template brand
- [ ] Failed SVG render gracefully skips slide
- [ ] Existing carousel rendering (non-mermaid slides) unaffected
- [ ] No XSS risk (mermaid SVG is from trusted mmdc, not user input)

---

### Phase 4: Polish + Template Variants
**Status**: Not Started

**Objectives:**
- Font tuning: ensure chosen fonts load reliably (local fallbacks if Google Fonts unavailable)
- If Blake picked multiple styles from Phase 0, implement additional template variant(s)
- Old templates (dark-purple.html, light.html) replaced or archived
- Template config updated with all new settings
- End-to-end test: full carousel render with new templates via Playwright
- Visual QA: Blake reviews final rendered PDFs
- Remove dead `summary` slide type from templates (not in carousel_slides.json enum)

**Estimated Time**: 2-3 hours

**Resources Needed:**
- Phase 1-3 templates
- Playwright for test rendering

**Dependencies:** Phase 3

**Files:**
- `kb/carousel_templates/config.json` — MODIFY: final config with all template settings
- `kb/carousel_templates/` — archive old templates, finalize new ones
- `kb/render.py` — MODIFY: any polish needed for template loading
- `kb/tests/test_carousel_templates.py` — MODIFY: comprehensive tests for new templates

**Acceptance Criteria:**
- [ ] Fonts load reliably (with offline fallback)
- [ ] Old templates archived, new templates are default
- [ ] Full carousel PDF renders correctly end-to-end
- [ ] Blake approves visual quality of rendered output
- [ ] Template selector in kb serve (T023 Phase 4) lists new templates
- [ ] Dead `summary` slide type removed

---

## Plan Review

### Round 1
- **Gate:** NEEDS_WORK
- **Reviewed:** 2026-02-08
- **Summary:** Well-structured mockup-first approach with logical phase ordering, but 3 critical technical gaps must be resolved: Jinja2 autoescape breaks inline SVG, no schema for structured content (bullets/lists), and render_pipeline hardcodes PNG MIME type. Plus 4 major issues around contradictions, missing config schema, and the mockup-to-Jinja2 conversion gap.
- **Issues:** 3 critical, 4 major, 4 minor
- **Required Fixes:**
  1. C1: Jinja2 autoescape breaks inline SVG — specify resolution
  2. C2: No schema for structured content (bullets/lists)
  3. C3: render_pipeline hardcodes PNG MIME type
  4. M1: Phase 1/4 profile photo contradiction
  5. M2: No config.json schema diff
  6. M3: No mockup→Jinja2 conversion guidance
  7. M4: Dead summary slide type

-> Details: `plan-review.md`

### Round 1 Fixes Applied
- **C1:** SVG embedding uses `Markup()` wrapping (D8). Mermaid SVG is from trusted mmdc, not user input. Specified in Phase 3.
- **C2:** Structured content as markdown in string (D7). LLM outputs markdown, template parses `- ` as bullets, `1. ` as numbered. No schema change — Jinja2 custom filter for markdown→HTML. Specified in Phase 2.
- **C3:** Phase 3 now specifies full render_pipeline changes: remove hardcoded `data:image/png`, switch to inline SVG via Markup(). render.py added to Phase 3 file list.
- **M1:** Profile photo consolidated in Phase 1 (D10). Removed from Phase 4.
- **M2:** Config.json schema additions specified in Phase 1 (brand.author_name, brand.community_name, brand.profile_photo_path, header settings).
- **M3:** Phase 1 now includes explicit mockup→Jinja2 conversion steps.
- **M4:** Phase 4 includes removing dead summary slide type.
- **Open questions:** Q5 (profile.png) → D9 (stored at kb/carousel_templates/profile.png). Q6 (structured content) → D7 (markdown in string). Q1/Q3 folded into Phase 0 mockups.

### Round 2
- **Gate:** READY
- **Reviewed:** 2026-02-08
- **Summary:** All 7 Round 1 issues adequately resolved. 0 critical, 2 major (executor-level, no replan needed), 3 minor. Plan is executable.
- **Issues:** 0 critical, 2 major, 3 minor
- **Major notes for executor:**
  1. `brand.author_name` vs existing `brand.name` -- treat as rename during Phase 1 config migration
  2. `carousel_slides.json` prompt needs markdown formatting instruction added in Phase 2
- **Open Questions Finalized:** None -- all resolved. Q1/Q3 deferred to Phase 0 visual review.

-> Details: `plan-review-r2.md`

---

## Execution Log

### Phase 0: Mockup Ideation
- **Status:** COMPLETE
- **Started:** 2026-02-08
- **Completed:** 2026-02-08
- **Commits:** `6a30a82`
- **Files Created:**
  - `kb/carousel_templates/mockups/1-clean-professional.html` — white/light bg, Inter font, dot-based timeline with labels, thin accent lines, minimal layout
  - `kb/carousel_templates/mockups/2-dark-bold.html` — dark #0A0A0F bg, Space Grotesk headings, gradient bar progress (orange-to-pink), step badges, rounded CTA button
  - `kb/carousel_templates/mockups/3-brand-purple.html` — #2D1B69 gradient bg, Plus Jakarta Sans, numbered circle timeline with connecting lines, purple accent palette, corner glow
  - `kb/carousel_templates/mockups/4-modern-editorial.html` — cream #FAF8F5 bg, Playfair Display serif headings, large editorial step numbers (01/02/03), magazine-style pip progress, pull-quote accents, issue numbering
  - `kb/carousel_templates/mockups/5-tech-minimal.html` — GitHub-dark #0D1117 bg, JetBrains Mono accents, terminal window chrome, breadcrumb path + bar progress, code-highlight spans, green prompt symbols
- **Notes:**
  - All 5 mockups are self-contained HTML, no build step, viewable in any browser
  - Each has 6 slides: title page, 3 content slides, 1 mermaid (inline SVG), 1 CTA
  - All slides 1080x1350px with `page-break-after: always`
  - Header bar (Blake Sims / Claude Code Architects) on every slide
  - Profile photo placeholder (gray circle with person SVG icon) on every title page
  - Timeline/progress indicators on all content slides — each style uses a visually distinct approach
  - Content uses bullets (ul) and numbered lists (ol), not block text
  - Mermaid diagrams are hand-crafted inline SVG styled to match each template's color palette
  - Google Fonts loaded via link tag (Inter, Space Grotesk, Plus Jakarta Sans, Playfair Display, Source Sans 3, JetBrains Mono)
  - Realistic AI/automation dummy content throughout

### Tasks Completed
- [x] Task 0.1: Created mockup directory at `kb/carousel_templates/mockups/`
- [x] Task 0.2: Built 1-clean-professional.html — light/minimal style
- [x] Task 0.3: Built 2-dark-bold.html — dark bg, bold gradients
- [x] Task 0.4: Built 3-brand-purple.html — evolved CCA purple
- [x] Task 0.5: Built 4-modern-editorial.html — magazine/serif layout
- [x] Task 0.6: Built 5-tech-minimal.html — code-editor/terminal style

### Acceptance Criteria Verification
- [x] AC1: 5 distinct HTML mockup files generated — all in `kb/carousel_templates/mockups/`
- [x] AC2: Each shows title page, 3 content slides, mermaid slide, CTA slide — 6 slides per file
- [x] AC3: Header bar visible on each slide with name + community
- [x] AC4: Profile photo placeholder on title slide — SVG person icon in styled circle
- [x] AC5: Timeline/progress indicator visible on content slides — 5 different approaches (dots, bar, numbered circles, editorial numbers+pips, breadcrumb+bar)
- [x] AC6: Content uses bullets/lists (not block text) — ul and ol elements with styled markers
- [x] AC7: Each file opens in browser at correct dimensions (1080x1350) — width/height set on `.slide` class
- [ ] AC8: Blake reviews and selects winner(s) — PENDING: requires human review

---

## Notes & Updates
- 2026-02-08: Task created from Blake's visual feedback on T022 carousel output. Boring layout, pixelated mermaid, no profile photo, block text. Redesign with mockup-first approach.
- 2026-02-08: Blake's template vision: book-style title page, timeline/progress circles on content slides, header with name + community, profile photo circular cutout. Each slide should be informative standalone.
