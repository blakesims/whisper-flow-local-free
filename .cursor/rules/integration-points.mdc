---
description: outlines key integration points with external services, libraries, and system functionalities for the Whisper Transcription UI project.
globs:
alwaysApply: false
---

# Integration Points and External Services


## 1. Configuration Management

-   **Service**: `app.utils.config_manager.ConfigManager` ([app/utils/config_manager.py](mdc:app/utils/config_manager.py))
-   **Configuration File**: `settings.json`
-   **Storage Location**: OS-specific application support directory (e.g., `~/Library/Application Support/WhisperTranscribeUI/` on macOS). The `ConfigManager` handles the exact path resolution.
-   **Format**: JSON.
-   **Defaults**: Default settings are defined within `ConfigManager` and are used if `settings.json` is missing or a key is not found.
-   **Access**: Use `ConfigManager.get('setting_key')` and `ConfigManager.set('setting_key', value)`.

## 2. Transcription Service (Faster-Whisper)

-   **Service**: `app.core.transcription_service.TranscriptionService` ([app/core/transcription_service.py](mdc:app/core/transcription_service.py))
-   **Library**: `faster-whisper`
-   **Model Loading**:
    -   Models are loaded using `faster_whisper.WhisperModel(model_name, device, compute_type)`.
    -   `faster-whisper` handles the download and caching of models to its default user cache directory.
-   **Configurable Parameters**:
    -   `model_name` (e.g., "tiny", "base", "small", "medium", "large-v3") - Should be configurable via `ConfigManager`.
    -   `device` ("cpu", "cuda") - Should be configurable via `ConfigManager`.
    -   `compute_type` ("int8", "float16", "float32") - Should be configurable via `ConfigManager`.
-   **Core Interface**:
    -   `TranscriptionService.transcribe(audio_path, language=None, task="transcribe", beam_size=5)`
    -   `audio_path`: Path to the audio file.
    -   `language`: Optional language code (e.g., "en", "es"). If `None`, auto-detects.
    -   `task`: "transcribe" or "translate".

## 3. Application Packaging (py2app)

-   **Build Script**: `setup.py` ([setup.py](mdc:setup.py))
-   **Main Application Entry Point**: `APP = ['app/main.py']` in `setup.py`.
-   **Included Packages**: Ensure all necessary Python packages are listed in `OPTIONS['packages']` within `setup.py` for proper bundling.
    -   Key packages: `PySide6`, `faster_whisper`, `sounddevice`, `numpy`, `scipy`, `pyperclip`, `rapidfuzz`.
-   **Application Metadata (`plist` in `setup.py` OPTIONS):**
    -   `CFBundleName`: "Whisper Transcription UI"
    -   `CFBundleDisplayName`: "Whisper Transcription UI"
    -   `CFBundleIdentifier`: e.g., "com.yourdomain.whispertranscribeui" (update as needed)
    -   `NSMicrophoneUsageDescription`: Essential for microphone access permission on macOS.
    -   `LSUIElement`: Set to `True` to make the app a "faceless" background application (no Dock icon, no main menu bar unless explicitly created).
-   **Application Icon**:
    -   Specified by `iconfile: 'resources/app_icon.icns'` in `setup.py`.
    -   The icon file should be placed at [resources/app_icon.icns](mdc:resources/app_icon.icns).

## 4. Audio Recording (SoundDevice)

-   **Library**: `sounddevice`
-   **Core Module (Planned)**: `app.core.audio_recorder.AudioRecorder` ([app/core/audio_recorder.py](mdc:app/core/audio_recorder.py))
-   **Functionality**: Will handle microphone input, audio data buffering, and saving to a temporary file.
-   **Configuration**: Sample rate (e.g., 16000 Hz) and channels (e.g., 1 for mono) will be important. These should be configurable if necessary, but good defaults will be set.

## 5. Clipboard Interaction (Pyperclip)

-   **Library**: `pyperclip`
-   **Functionality**: Used to copy transcribed text (and potentially Fabric-processed text) to the system clipboard.
-   **Usage**: `pyperclip.copy("text_to_copy")`.

## 6. Fabric Pattern Processing (CLI)

-   **Mechanism**: Interacts with the `fabric` CLI tool via `subprocess`.
-   **Workflow**:
    1.  Transcribed text is piped to `fabric`.
    2.  A specific pattern is supplied using the `--pattern` argument.
    3.  Output from `fabric` is captured.
-   **Pattern Discovery**: The application will need a way to list available Fabric patterns (e.g., by running `fabric -l` or by reading from a known directory if patterns are local).
-   **Integration Point (Example from MVP)**:
    ```python
    # command = f'echo "{transcription_text}" | fabric --pattern "{prompt}"'
    # output = subprocess.check_output(command, shell=True, universal_newlines=True)
    ```

## 7. Raycast Integration (Planned)

-   **Mechanism**: The application will be launchable via a Raycast keyboard shortcut.
-   **Implementation**: This typically involves configuring Raycast to run a script or open the packaged `.app` bundle. The `LSUIElement : True` setting in `setup.py` is relevant for how the app behaves when launched this way.


